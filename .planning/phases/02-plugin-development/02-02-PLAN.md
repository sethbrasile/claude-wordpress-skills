---
phase: 02-plugin-development
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/wp-plugin-development/references/architecture-patterns.md
  - skills/wp-plugin-development/references/hooks-guide.md
  - skills/wp-plugin-development/references/oop-patterns.md
  - skills/wp-plugin-development/references/api-patterns.md
autonomous: true

must_haves:
  truths:
    - "Each reference doc provides deep-dive coverage that extends SKILL.md patterns"
    - "Reference docs follow cookbook format: quick reference table + detailed patterns + edge cases + WP nuances"
    - "All code examples follow WordPress PHP Coding Standards with BAD/GOOD pairs"
    - "Security-relevant patterns cross-reference wp-security-review instead of duplicating"
  artifacts:
    - path: "skills/wp-plugin-development/references/architecture-patterns.md"
      provides: "Plugin file organization, singleton/static patterns, autoloading, main plugin class, conditional loading"
      min_lines: 300
    - path: "skills/wp-plugin-development/references/hooks-guide.md"
      provides: "Action/filter lifecycle, priority system, hook removal, custom hooks, pluggable functions, naming conventions"
      min_lines: 300
    - path: "skills/wp-plugin-development/references/oop-patterns.md"
      provides: "Class-based plugin architecture, namespaces, PSR-4 autoloading, traits, abstract classes, service container"
      min_lines: 250
    - path: "skills/wp-plugin-development/references/api-patterns.md"
      provides: "Settings API workflow, Options API, REST API endpoints, Transients API, custom database tables with dbDelta"
      min_lines: 300
  key_links:
    - from: "skills/wp-plugin-development/references/architecture-patterns.md"
      to: "Other reference docs"
      via: "Cross-references to hooks-guide, oop-patterns, api-patterns"
      pattern: "See.*guide\\.md|See.*patterns\\.md"
---

<objective>
Create the 4 reference documents for wp-plugin-development -- deep-dive companion guides that extend the SKILL.md with comprehensive patterns, edge cases, and WordPress-specific nuances.

Purpose: Reference docs are loaded by Claude on-demand when deeper analysis is needed. They provide the exhaustive pattern catalog that would be too large for SKILL.md itself.

Output: 4 markdown files in `skills/wp-plugin-development/references/` totaling ~1500+ lines of plugin development guidance.
</objective>

<execution_context>
@/Users/seth/.claude/get-shit-done/workflows/execute-plan.md
@/Users/seth/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-plugin-development/02-CONTEXT.md
@.planning/phases/02-plugin-development/02-RESEARCH.md
@skills/wp-security-review/references/vulnerability-patterns.md
@skills/wp-performance-review/references/anti-patterns.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create architecture-patterns.md and hooks-guide.md reference docs</name>
  <files>
    skills/wp-plugin-development/references/architecture-patterns.md
    skills/wp-plugin-development/references/hooks-guide.md
  </files>
  <action>
Create both reference docs following the cookbook format established by wp-security-review references (quick reference table + detailed patterns + edge cases + WP nuances). Use 02-RESEARCH.md as primary content source.

**File 1: architecture-patterns.md (PLG-25)**

Structure:
1. **Quick Reference Table** -- Plugin architecture decision table (pattern name, when to use, complexity level)
2. **Recommended File Structure** -- Standard plugin directory layout with annotations explaining each directory's purpose. Include WordPress Plugin Boilerplate structure as reference.
3. **Main Plugin File Patterns** -- Three approaches with BAD/GOOD:
   - Procedural (simple plugins): all in one file with prefixed functions
   - Class-based (medium plugins): main plugin class with static instance, hooks in constructor
   - Namespace-based (complex plugins): PSR-4 autoloading, dependency injection (links to oop-patterns.md)
4. **Plugin Constants** -- Defining PLUGIN_VERSION, PLUGIN_DIR, PLUGIN_URL, PLUGIN_BASENAME with plugin_dir_path() and plugin_dir_url(). BAD: hardcoded paths. GOOD: constants using WordPress functions.
5. **Activation/Deactivation/Uninstall Deep Dive** -- Complete lifecycle patterns:
   - Activation: version check, default options, DB table creation (dbDelta), flush_rewrite_rules, capability setup
   - Deactivation: transient cleanup, cron unscheduling, rewrite flush. DO NOT delete data.
   - Uninstall: uninstall.php (preferred) vs register_uninstall_hook. Cleanup: delete_option, drop tables, delete_metadata, remove capabilities. WP_UNINSTALL_PLUGIN constant check.
   - Version upgrade pattern: compare stored version with current, run upgrade routines
6. **Conditional Loading** -- is_admin() separation, loading admin-only code, frontend-only code, REST API detection. BAD: loading all code everywhere. GOOD: targeted loading.
7. **Prefixing Deep Dive** -- What to prefix (functions, classes, options, transients, post types, taxonomy names, cron hooks, REST namespace), choosing a prefix (4-5 chars, unique, memorable), PHP namespace as alternative.
8. **Plugin Dependencies** -- Requires Plugins header (WP 6.5+), function_exists()/class_exists() checks, admin notices for missing dependencies.
9. **Common Architecture Anti-Patterns** -- Table: God class, no separation of concerns, global state abuse, loading everything on every page, hardcoded paths, missing uninstall cleanup.

All code examples: WordPress PHP Coding Standards, BAD/GOOD pairs, 4-5 char "mypl_" prefix in examples.

**File 2: hooks-guide.md (PLG-26)**

Structure:
1. **Quick Reference Table** -- Hook functions table (add_action, add_filter, remove_action, remove_filter, do_action, apply_filters, has_action, has_filter, did_action) with parameters and return types
2. **Actions vs Filters** -- Fundamental distinction: actions DO things, filters MODIFY things. Actions return nothing, filters MUST return a value. BAD: filter without return. GOOD: filter with return.
3. **Hook Lifecycle** -- Complete WordPress execution order: muplugins_loaded -> plugins_loaded -> setup_theme -> after_setup_theme -> init -> wp_loaded -> admin_init (admin) / template_redirect (frontend). When to hook what.
4. **Priority System Deep Dive** -- Default 10, lower = earlier, same priority = registration order. When to use lower priority (before core), higher priority (after core, override). BAD: relying on default priority for order-dependent code. GOOD: explicit priority.
5. **Accepted Args** -- How $accepted_args works, passing multiple parameters, common mistake of not declaring enough args. BAD: accessing undefined parameter. GOOD: declaring correct accepted_args count.
6. **Removing Hooks** -- Must match exact registration params (callback, priority). Removing class method hooks (requires same instance or static method). Common failure: priority mismatch. BAD/GOOD examples.
7. **Custom Hooks for Extensibility** -- Creating action hooks (do_action) and filter hooks (apply_filters) for other developers. Naming conventions (prefix_noun_verb). Documenting custom hooks. BAD: no extension points. GOOD: well-placed custom hooks.
8. **Common Hook Patterns** -- Practical patterns:
   - Init hook for registering CPTs/taxonomies
   - admin_init for Settings API
   - wp_enqueue_scripts for frontend assets
   - admin_enqueue_scripts for admin assets
   - rest_api_init for REST routes
   - admin_menu for menu pages
   - plugin_action_links for settings link
   - wp_ajax_ for AJAX handlers
9. **Hook Debugging** -- has_action()/has_filter() for checking hook registration, did_action() for checking if action fired, current_filter() for determining current hook, WP_DEBUG and error_log for hook debugging.
10. **Anti-Patterns** -- Hooking too early, hooking with wrong priority, forgetting to return in filters, anonymous function callbacks (can't be removed), action callback with return value (ignored), excessive remove_action on core hooks.

All code examples: WordPress PHP Coding Standards, BAD/GOOD pairs.
  </action>
  <verify>
- `skills/wp-plugin-development/references/architecture-patterns.md` exists with 300+ lines
- `skills/wp-plugin-development/references/hooks-guide.md` exists with 300+ lines
- Both files have quick reference tables at the top
- Both use cookbook format (table + patterns + edge cases)
- All code examples follow WordPress PHP Coding Standards
- BAD/GOOD pairs present throughout
- architecture-patterns.md covers file structure, lifecycle, prefixing, conditional loading
- hooks-guide.md covers action/filter distinction, priority, removal, custom hooks
  </verify>
  <done>
architecture-patterns.md provides complete plugin file organization, lifecycle management, prefixing, and conditional loading patterns. hooks-guide.md provides complete action/filter system coverage including priority, removal, custom hooks, and common patterns. Both follow cookbook format with BAD/GOOD code pairs.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create oop-patterns.md and api-patterns.md reference docs</name>
  <files>
    skills/wp-plugin-development/references/oop-patterns.md
    skills/wp-plugin-development/references/api-patterns.md
  </files>
  <action>
Create both reference docs following the same cookbook format. Use 02-RESEARCH.md as primary content source.

**File 1: oop-patterns.md (PLG-26 partial)**

Structure:
1. **Quick Reference Table** -- OOP pattern decision table (pattern, use case, complexity, WP compatibility)
2. **Class-Based Plugin Pattern** -- The standard WordPress plugin class approach: private constructor, static instance method, hooks in init/register methods. BAD: hooks in constructor (can't test). GOOD: hooks in dedicated register method. Include singleton vs static factory comparison.
3. **PHP Namespaces for WordPress** -- namespace declaration, use statements, hooking namespaced functions (__NAMESPACE__ . '\function_name'), class autoloading with namespaces. BAD: manual require_once for every file. GOOD: spl_autoload_register with namespace-to-path mapping.
4. **PSR-4 Autoloading** -- Composer autoloading for WordPress plugins: composer.json autoload config, directory structure matching namespace, vendor/autoload.php loading. When to use (complex plugins with many classes) vs when to skip (simple plugins). Note: WordPress.org plugins should include vendor directory, not require composer install.
5. **Trait Usage** -- Reusable behavior across plugin classes. Practical traits: HasHooks (register/deregister), HasSettings (option getters/setters), Singleton. BAD: deep inheritance hierarchies. GOOD: trait composition.
6. **Abstract Classes for Extensibility** -- Base class patterns: Abstract_Admin_Page, Abstract_Post_Type, Abstract_Widget. Define interface, let child classes implement specifics. When abstract classes help (multiple similar components) vs when they add unnecessary complexity.
7. **Service Container Pattern** -- Simple dependency container for WordPress plugins. Register services in main class, retrieve where needed. Not a full DI framework -- practical WordPress-scale container. BAD: creating dependencies inside methods. GOOD: injecting via container.
8. **WordPress-Specific OOP Considerations** -- Hooking class methods (array($this, 'method') vs array('ClassName', 'method')), removing class method hooks (needs same instance), $this vs self:: vs static::, PHP version requirements (namespaces require PHP 5.3+, which is fine for WP 6.x).
9. **Anti-Patterns** -- Over-engineering simple plugins, framework-itis (building a framework instead of a plugin), God class (one class does everything), tight coupling between classes, static abuse.

Depth guidance: Focus on practical WordPress-specific patterns, not a PHP design patterns textbook. Include enough to guide good architecture for medium-to-complex plugins.

**File 2: api-patterns.md (PLG-26 partial)**

Structure:
1. **Quick Reference Table** -- WordPress API function table organized by API (Settings, Options, REST, Transients, Database) with function name, purpose, and hook
2. **Settings API Complete Workflow** -- Full step-by-step:
   - register_setting() with type, sanitize_callback, default, show_in_rest params
   - add_settings_section() linking to page slug
   - add_settings_field() linking to section and page
   - Form HTML: settings_fields(), do_settings_sections(), submit_button()
   - Sanitization callback patterns for different field types (text, checkbox, select, number, array)
   - BAD: manual form handling with custom nonces. GOOD: Settings API handles everything.
   - Common mistakes: field won't save (missing register_setting), section doesn't appear (wrong page slug), option doesn't validate (missing sanitize_callback)
3. **Options API Best Practices** -- get_option() with defaults, update_option() vs add_option(), delete_option() cleanup, option autoloading (set autoload to 'no' for large/infrequent options), storing multiple settings in one option (array) vs separate options. Prefixing option names.
4. **REST API Endpoint Registration** (non-security) -- register_rest_route() complete workflow:
   - Namespace with version (myplugin/v1)
   - Route with regex params (?P<id>\d+)
   - Methods (GET, POST, PUT, DELETE, WP_REST_Server constants)
   - callback function returning WP_REST_Response or WP_Error
   - args with sanitize_callback, validate_callback, default, required
   - Schema definition for self-documenting endpoints
   - Note: For permission_callback security patterns, see wp-security-review skill
5. **Transients API** -- set_transient() with expiration, get_transient() with fallback, delete_transient() cleanup, transient naming (prefixed, under 172 chars including _transient_ prefix), choosing expiration time, when to invalidate. BAD: transient without expiration. GOOD: with appropriate HOUR_IN_SECONDS/DAY_IN_SECONDS constant.
6. **Custom Database Tables** -- When to use custom tables vs post meta vs custom post types (decision guide). dbDelta() requirements:
   - Two spaces after PRIMARY KEY (quirk)
   - Each field on own line
   - Key definition after field definitions
   - $wpdb->get_charset_collate()
   - require_once ABSPATH . 'wp-admin/includes/upgrade.php'
   - Version tracking for schema updates
   BAD: $wpdb->query("CREATE TABLE..."). GOOD: dbDelta() with proper formatting.
7. **AJAX Handler Patterns** (non-security) -- wp_ajax_{action} and wp_ajax_nopriv_{action} hooks, wp_send_json_success/error for responses, wp_localize_script for passing ajaxurl and nonce to JavaScript. Note: REST API preferred for new code (lighter bootstrap).
8. **Cron API** -- wp_schedule_event() with schedule check, wp_next_scheduled() to prevent duplicates, wp_clear_scheduled_hook() on deactivation, custom schedules via cron_schedules filter. BAD: scheduling without checking if already scheduled. GOOD: wp_next_scheduled check first.
9. **Admin Menu API** -- add_menu_page(), add_submenu_page(), add_options_page() shortcuts, capability parameter for access control, menu slugs and page callbacks, plugin_action_links filter for settings link in plugins list.

All code examples: WordPress PHP Coding Standards, BAD/GOOD pairs, prefixed with "mypl_".
Security-relevant patterns (nonces, capability checks): brief mention + cross-reference to wp-security-review.
  </action>
  <verify>
- `skills/wp-plugin-development/references/oop-patterns.md` exists with 250+ lines
- `skills/wp-plugin-development/references/api-patterns.md` exists with 300+ lines
- Both files have quick reference tables at the top
- Both use cookbook format (table + patterns + edge cases)
- All code examples follow WordPress PHP Coding Standards
- BAD/GOOD pairs present throughout
- oop-patterns.md covers class-based plugins, namespaces, PSR-4, traits, service container
- api-patterns.md covers Settings API, Options API, REST API, Transients, dbDelta, AJAX, Cron, Admin Menu
- Security patterns cross-reference wp-security-review (not duplicated)
  </verify>
  <done>
oop-patterns.md provides practical WordPress OOP patterns (class-based plugins, namespaces, PSR-4, traits, service container) without over-engineering. api-patterns.md provides complete API workflow coverage (Settings, Options, REST, Transients, dbDelta, AJAX, Cron, Admin Menu) with security cross-references. Both follow cookbook format with BAD/GOOD code pairs.
  </done>
</task>

</tasks>

<verification>
- All 4 reference docs exist in `skills/wp-plugin-development/references/`
- Each has quick reference table at top (cookbook format)
- Total line count across all 4 files is 1200+ lines
- BAD/GOOD code pairs used throughout
- WordPress PHP Coding Standards in all examples
- Cross-references between reference docs present
- Security-relevant patterns reference wp-security-review skill
- architecture-patterns.md covers PLG-25 requirements
- hooks-guide.md, oop-patterns.md, api-patterns.md collectively cover PLG-26 requirements
</verification>

<success_criteria>
- All 4 reference docs provide deep-dive companion content to SKILL.md
- Any topic mentioned in SKILL.md that says "see references" has corresponding depth in a reference doc
- Code examples are copy-pasteable and follow WordPress standards
- A Claude instance could load any reference doc to get comprehensive guidance on that topic
</success_criteria>

<output>
After completion, create `.planning/phases/02-plugin-development/02-02-SUMMARY.md`
</output>
