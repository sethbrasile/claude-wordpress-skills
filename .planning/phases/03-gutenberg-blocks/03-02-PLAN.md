---
phase: 03-gutenberg-blocks
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/wp-block-development/references/block-json-guide.md
  - skills/wp-block-development/references/editor-patterns.md
  - skills/wp-block-development/references/dynamic-blocks-guide.md
  - skills/wp-block-development/references/interactivity-api-guide.md
autonomous: true

must_haves:
  truths:
    - "Each reference doc provides deep-dive coverage that extends SKILL.md patterns"
    - "Reference docs follow cookbook format: quick reference table + detailed patterns + edge cases + WP nuances"
    - "PHP code examples follow WordPress PHP Coding Standards; JS/JSX examples follow WordPress JS coding standards"
    - "All code examples use BAD/GOOD pairs"
    - "Security-relevant patterns cross-reference wp-security-review instead of duplicating"
    - "Plugin architecture patterns cross-reference wp-plugin-development instead of duplicating"
  artifacts:
    - path: "skills/wp-block-development/references/block-json-guide.md"
      provides: "Complete block.json schema reference with every field, validation rules, apiVersion differences, supports catalog"
      min_lines: 400
    - path: "skills/wp-block-development/references/editor-patterns.md"
      provides: "React/JSX patterns for block editor: useBlockProps, RichText, InspectorControls, BlockControls, InnerBlocks, useSelect/useDispatch"
      min_lines: 400
    - path: "skills/wp-block-development/references/dynamic-blocks-guide.md"
      provides: "Server-side rendering: render_callback vs render PHP file, WP_Block object, block context, dynamic vs static decision guide"
      min_lines: 300
    - path: "skills/wp-block-development/references/interactivity-api-guide.md"
      provides: "WP 6.5+ Interactivity API: directive catalog, state management, context passing, server-side setup"
      min_lines: 350
  key_links:
    - from: "skills/wp-block-development/references/block-json-guide.md"
      to: "Other reference docs"
      via: "Cross-references to editor-patterns, dynamic-blocks-guide, interactivity-api-guide"
      pattern: "See.*guide\\.md|See.*patterns\\.md"
    - from: "skills/wp-block-development/references/editor-patterns.md"
      to: "skills/wp-security-review"
      via: "Security cross-references for permission patterns"
      pattern: "wp-security-review|/wp-sec-review"
---

<objective>
Create the 4 reference documents for wp-block-development -- deep-dive companion guides that extend the SKILL.md with comprehensive patterns, edge cases, and WordPress-specific nuances for block development.

Purpose: Reference docs are loaded by Claude on-demand when deeper analysis is needed. They provide the exhaustive pattern catalog that would be too large for SKILL.md itself. These docs cover both PHP and JavaScript/React patterns organized by concern (not by language).

Output: 4 markdown files in `skills/wp-block-development/references/` totaling ~2000+ lines of block development guidance.
</objective>

<execution_context>
@/Users/seth/.claude/get-shit-done/workflows/execute-plan.md
@/Users/seth/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-gutenberg-blocks/03-CONTEXT.md
@.planning/phases/03-gutenberg-blocks/03-RESEARCH.md
@skills/wp-plugin-development/references/architecture-patterns.md
@skills/wp-security-review/references/vulnerability-patterns.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create block-json-guide.md and editor-patterns.md reference docs</name>
  <files>
    skills/wp-block-development/references/block-json-guide.md
    skills/wp-block-development/references/editor-patterns.md
  </files>
  <action>
Create both reference docs following the cookbook format established by prior skills (quick reference table + detailed patterns + edge cases + WP nuances). Use 03-RESEARCH.md as primary content source.

**File 1: block-json-guide.md (BLK-26)**

Structure:
1. **Quick Reference Table** -- Every block.json field with type, required/optional, description, and example value. Organized in sections: metadata, assets, behavior, supports.
2. **Schema and Validation** -- $schema URL for VS Code / IDE validation, how WordPress validates block.json at registration time, common validation errors and how to debug them.
3. **apiVersion Deep Dive** -- Differences between apiVersion 1, 2, and 3:
   - apiVersion 1: Legacy, no useBlockProps, manual wrapper management
   - apiVersion 2: useBlockProps required, editor uses same DOM structure
   - apiVersion 3 (WP 6.3+): Iframe editor isolation, className NOT auto-injected in save (must use useBlockProps.save())
   - Migration guide from 2 to 3 with BAD/GOOD pairs
4. **Block Name and Registration** -- "namespace/block-name" format, naming conventions, relationship between block.json name and register_block_type() path, how WordPress resolves block.json from directory path.
5. **Attributes Schema** -- Complete attribute types (string, number, boolean, object, array, integer, null), sources (attribute, text, html, query, meta[deprecated]), selector syntax, default values. Type mismatch dangers. BAD/GOOD pairs for each source type.
6. **Supports Catalog** -- Every supports flag with description, default value, and what it enables:
   - color (text, background, gradients, link, button, heading, enableContrastChecker)
   - spacing (margin, padding, blockGap)
   - typography (fontSize, lineHeight, fontFamily, fontWeight, fontStyle, textTransform, letterSpacing, textDecoration)
   - align (true/array of values), anchor, html, className, customClassName
   - interactivity, layout, dimensions, position, shadow
   BAD: missing supports (users can't customize). GOOD: appropriate supports enabled.
7. **Asset Registration** -- editorScript, script, viewScript, viewScriptModule, editorStyle, style fields. "file:./path" format. How WordPress auto-generates .asset.php dependency files. When to use viewScript vs viewScriptModule (Interactivity API). BAD: manual wp_enqueue_script. GOOD: block.json asset registration.
8. **Block Categories and Icons** -- Standard categories (text, media, design, widgets, theme, embed), custom categories via block_categories_all filter, icon as Dashicon slug or custom SVG, keywords for search.
9. **Render Property** -- "render": "file:./render.php" syntax, how WordPress resolves the file path, relationship to render_callback in PHP, precedence rules (render file > render_callback).
10. **Block Variations in block.json** -- variations array structure, isDefault, scope (inserter/transform/block), icon override. Distinction from PHP-registered variations.
11. **Block Hooks in block.json** -- blockHooks property (WP 6.4+), position values (before/after/firstChild/lastChild), dynamic blocks only limitation. BAD: static block with blockHooks. GOOD: dynamic block with blockHooks.
12. **Common block.json Mistakes** -- Table of frequent errors: missing textdomain, apiVersion as string not number, relative paths without "file:" prefix, attribute source/selector mismatch, forgetting category, supports nested incorrectly.

All examples use valid JSON with annotations via comments above the JSON object.

**File 2: editor-patterns.md (BLK-27)**

Structure:
1. **Quick Reference Table** -- @wordpress/* packages used in block editor development, organized by: components, hooks, data access, i18n. Package name, key exports, when to use.
2. **useBlockProps Deep Dive** -- How useBlockProps() works, what it adds (data-* attributes, class names, style), merging custom props, useBlockProps() in edit vs useBlockProps.save() in save. BAD: manual className without useBlockProps. GOOD: useBlockProps with optional custom props merged. useInnerBlocksProps and its relationship to useBlockProps (BLK-15: call useBlockProps first, pass result to useInnerBlocksProps).
3. **RichText Component** -- Complete props catalog (tagName, value, onChange, placeholder, allowedFormats, multiline, keepPlaceholderOnFocus), RichText.Content in save function, format types. BAD: contentEditable div. GOOD: RichText with proper props.
4. **InspectorControls and BlockControls (BLK-20)** -- Sidebar settings (InspectorControls with PanelBody) vs toolbar controls (BlockControls with ToolbarGroup/ToolbarButton). InspectorControls group prop for Settings/Appearance tabs (WP 6.2+). Common control components: ToggleControl, TextControl, SelectControl, RangeControl, ColorPalette, MediaUpload, DateTimePicker.
5. **InnerBlocks Patterns** -- allowedBlocks array, template with pre-defined blocks, templateLock (all/insert/contentOnly/false), orientation (horizontal/vertical). InnerBlocks.Content in save. Dynamic blocks with InnerBlocks: save MUST return InnerBlocks.Content (BLK-14 critical gotcha). useInnerBlocksProps for custom wrapper (BLK-15).
6. **Attributes and State Management** -- Receiving attributes in edit function, setAttributes for updates, using attributes in save, attribute defaults. Controlled component pattern for form inputs.
7. **useSelect and useDispatch (Data API)** -- Reading from WordPress data stores (core, core/editor, core/block-editor, core/edit-post), dispatching actions. Performance: single useSelect call for multiple values (BLK-related pitfall). Common selectors: getEditedPostAttribute, getBlocks, getBlockAttributes. BAD: multiple useSelect calls. GOOD: combined single useSelect.
8. **useEntityProp** -- Replacing deprecated source:'meta' pattern. useEntityProp('postType', 'post', 'meta') for post meta access. EntityProvider context.
9. **Block Deprecation Patterns (BLK-09)** -- deprecated array structure, save function versioning, migrate function for attribute transformation, apiVersion in deprecation entries, isEligible for conditional migration, newest-first ordering. Complete lifecycle: save changes -> add deprecation -> update save. BAD: changing save without deprecation. GOOD: deprecation entry with old save, migrate, apiVersion.
10. **Import Patterns and Build** -- @wordpress/* package imports (correct), window.wp.* (legacy), import metadata from './block.json'. How @wordpress/scripts handles imports (externals). package.json scripts configuration: build, start, lint-js, lint-css. BAD: require() for WordPress packages. GOOD: ES import from @wordpress/*.
11. **i18n in Block Editor** -- __() and _e() from @wordpress/i18n, text domain matching plugin slug, sprintf() for parameterized strings, _n() for plurals. block.json title/description auto-translated via text domain. BAD: hardcoded strings. GOOD: __() wrapped strings.
12. **Anti-Patterns** -- Using React state instead of block attributes (lost on save), not spreading blockProps, inline styles instead of block supports, fetching data in save function (impossible -- runs in browser without network), using className prop directly instead of useBlockProps.

All JS/JSX examples: WordPress JS coding standards (tab indentation, camelCase, PascalCase for components), BAD/GOOD pairs.
  </action>
  <verify>
- `skills/wp-block-development/references/block-json-guide.md` exists with 400+ lines
- `skills/wp-block-development/references/editor-patterns.md` exists with 400+ lines
- Both files have quick reference tables at the top
- Both use cookbook format (table + patterns + edge cases)
- block-json-guide.md: PHP examples follow WP PHP Coding Standards, JSON examples are valid
- editor-patterns.md: JS/JSX examples follow WP JS coding standards
- BAD/GOOD pairs present throughout
- block-json-guide.md covers apiVersion differences, attributes schema, supports catalog, asset registration
- editor-patterns.md covers useBlockProps, RichText, InspectorControls, InnerBlocks, useSelect/useDispatch, deprecation patterns
  </verify>
  <done>
block-json-guide.md provides complete block.json schema reference with apiVersion differences, attributes deep dive, supports catalog, and asset registration patterns. editor-patterns.md provides comprehensive React/JSX patterns for block editor development including useBlockProps, RichText, controls, InnerBlocks, data API, deprecations, and import patterns. Both follow cookbook format with appropriate coding standard examples and BAD/GOOD pairs.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create dynamic-blocks-guide.md and interactivity-api-guide.md reference docs</name>
  <files>
    skills/wp-block-development/references/dynamic-blocks-guide.md
    skills/wp-block-development/references/interactivity-api-guide.md
  </files>
  <action>
Create both reference docs following the same cookbook format. Use 03-RESEARCH.md as primary content source.

**File 1: dynamic-blocks-guide.md (BLK-26 partial)**

Structure:
1. **Quick Reference Table** -- Dynamic block decision table: approach (render_callback, render file, hybrid), when to use, PHP complexity, WP version.
2. **Static vs Dynamic Decision Guide** -- When to use static save (content fixed, simple HTML, no updates needed), when to use dynamic (content changes, needs PHP processing, markup should update without re-saving posts, blocks with latest content queries). Decision tree format.
3. **render_callback Pattern** -- register_block_type() with render_callback in PHP, function signature ($attributes, $content, $block), accessing $attributes array, using $content for InnerBlocks content, $block WP_Block instance. BAD: inline anonymous function. GOOD: named function with proper signature.
4. **render PHP File Pattern** -- "render": "file:./render.php" in block.json, available variables ($attributes, $content, $block), file resolved relative to block.json. BAD: separate include/require. GOOD: render property in block.json. Note: render file takes precedence over render_callback.
5. **get_block_wrapper_attributes()** -- Generates wrapper attributes matching what useBlockProps provides in JS. Merging custom classes and attributes. BAD: manual class concatenation `<div class="my-block">`. GOOD: `<div <?php echo get_block_wrapper_attributes(); ?>>`.
6. **WP_Block Object** -- Properties: $attributes, $parsed_block, $context, $block_type. Methods: render(). Accessing block context in render callback.
7. **Block Context in PHP** -- Receiving context from parent blocks via $block->context. Checking for context before use. Cross-reference to block.json providesContext/usesContext configuration.
8. **InnerBlocks with Dynamic Blocks (BLK-14 CRITICAL)** -- The #1 gotcha: dynamic blocks with InnerBlocks MUST have save function return `<InnerBlocks.Content />` (not null). Why: InnerBlocks are saved to the database from the save function. render_callback only generates the WRAPPER -- $content parameter contains the saved inner blocks. BAD: save returns null with InnerBlocks. GOOD: save returns InnerBlocks.Content, render_callback wraps $content.
9. **Escaping in Render Callbacks** -- esc_html() for text content, esc_attr() for attributes, esc_url() for URLs, wp_kses_post() for rich HTML. CRITICAL: Do NOT use wp_kses_post() on $content from InnerBlocks (BLK-21) -- inner blocks are already sanitized and wp_kses_post strips embed blocks and oEmbed processing. BAD: `echo wp_kses_post( $content )`. GOOD: `echo $content` for inner blocks.
10. **Hybrid Blocks** -- Blocks with static save AND server-side enhancement. Save function stores base HTML, render_callback adds dynamic elements (e.g., current date, logged-in user info). Less common pattern.
11. **Querying Data in Dynamic Blocks** -- WP_Query in render_callback for "Latest Posts" style blocks, caching considerations, avoiding N+1 queries. Performance cross-reference to wp-performance-review.
12. **Common Dynamic Block Mistakes** -- Table: forgetting to escape output, using echo instead of return in render_callback (both work but return is cleaner for nesting), not checking if attributes exist before using, missing ABSPATH check in render.php, hardcoded HTML without wrapper attributes.

All PHP examples: WordPress PHP Coding Standards (spaces in parentheses, array() not [], Yoda conditions, snake_case). BAD/GOOD pairs throughout.
Security cross-references for escaping patterns.

**File 2: interactivity-api-guide.md (BLK-28)**

Structure:
1. **Quick Reference Table** -- Every data-wp-* directive with syntax, purpose, and example. Table format: Directive | Type | Purpose | Example.
2. **What is the Interactivity API** -- Declarative frontend interaction system for WordPress 6.5+. KEY DISTINCTION: Interactivity API is for the FRONTEND only -- the editor still uses React. It replaces custom JavaScript for common interactions (toggles, tabs, accordions, fetching data). Server-side state hydration -- state defined in PHP, reactive in browser.
3. **Setup Requirements** -- block.json needs viewScriptModule (NOT viewScript) pointing to view.js. PHP: wp_interactivity_state() in render_callback or render.php. JS: store() from @wordpress/interactivity. HTML: data-wp-interactive="namespace" on wrapper element.
4. **Directive Catalog** -- Complete coverage of each directive with syntax and examples:
   - data-wp-interactive="namespace" -- Required wrapper, sets namespace for all child directives
   - data-wp-bind--{attr}="reference" -- Bind HTML attributes (hidden, disabled, href, src, class, style, aria-*)
   - data-wp-on--{event}="handler" -- Event handlers (click, input, submit, keydown)
   - data-wp-class--{name}="reference" -- Toggle CSS classes
   - data-wp-style--{prop}="reference" -- Dynamic inline styles
   - data-wp-text="reference" -- Text content binding
   - data-wp-context='{"key":"value"}' -- Local context for a subtree (JSON in attribute)
   - data-wp-watch="callback" -- Side effects when state changes
   - data-wp-init="callback" -- Run once on mount
   - data-wp-each="reference" -- List rendering / iteration
   BAD/GOOD pair for each directive showing incorrect vs correct usage.
5. **State Management** -- Server-side: wp_interactivity_state('namespace', array(...)). Client-side: store('namespace', { state: {}, actions: {}, callbacks: {} }). Accessing state in directives: "state.propertyName". Accessing context: getContext(). State is reactive -- mutate directly, no setState().
6. **Actions and Callbacks** -- Actions: user-triggered functions (click handlers). Callbacks: derived values (computed from state). Accessing store parameter destructured from first argument: ({ state, context }). Using getContext() for element-scoped data.
7. **Server-Side Setup in PHP** -- wp_interactivity_state() for global state, wp_interactivity_config() for configuration. Merging server state with client state. Passing PHP data to frontend state. Security consideration: never put sensitive data in interactivity state (it's rendered in HTML). Cross-reference wp-security-review.
8. **Context vs State** -- State: global, shared across all instances. Context: local, scoped to a DOM subtree (via data-wp-context). When to use state vs context. BAD: everything in global state. GOOD: instance-specific data in context, shared data in state.
9. **Integration with Dynamic Blocks** -- render.php template with directives in HTML attributes, wp_interactivity_state() before template output, viewScriptModule in block.json for the store. Complete example showing full flow: block.json -> render.php -> view.js.
10. **Common Interactivity API Mistakes** -- Using viewScript instead of viewScriptModule, forgetting data-wp-interactive on wrapper, state mutation outside actions (won't trigger reactivity), trying to use Interactivity API in the editor (it's frontend only), mixing React and Interactivity API in same render output, forgetting to escape user input before putting in state.
11. **When NOT to Use Interactivity API** -- Simple CSS-only interactions (hover, focus), interactions that need React component library, blocks targeting WP < 6.5, extremely complex state management (consider custom JS). Use when: standard interactions (toggle, accordion, tabs, load more), server-state-driven UI, want zero custom JS bundle.

All PHP examples: WordPress PHP Coding Standards.
All JS examples: WordPress JS coding standards (tab indentation, camelCase).
HTML directive examples: valid HTML attributes with data-wp-* syntax.
BAD/GOOD pairs throughout.
WP 6.5+ version markers throughout.
Security cross-references where user input touches state.
  </action>
  <verify>
- `skills/wp-block-development/references/dynamic-blocks-guide.md` exists with 300+ lines
- `skills/wp-block-development/references/interactivity-api-guide.md` exists with 350+ lines
- Both files have quick reference tables at the top
- Both use cookbook format (table + patterns + edge cases)
- dynamic-blocks-guide.md: PHP examples follow WP PHP Coding Standards
- interactivity-api-guide.md: Both PHP and JS examples follow appropriate standards, HTML directives are valid
- BAD/GOOD pairs present throughout
- dynamic-blocks-guide.md covers static vs dynamic decision, render_callback, render file, InnerBlocks gotcha (BLK-14), escaping (BLK-21)
- interactivity-api-guide.md covers all directives, state management, context vs state, WP 6.5+ markers
- Security cross-references present in both docs
  </verify>
  <done>
dynamic-blocks-guide.md provides complete server-side rendering coverage including static vs dynamic decision guide, render_callback/render file patterns, InnerBlocks critical gotcha, escaping rules (including wp_kses_post anti-pattern), and WP_Block object reference. interactivity-api-guide.md provides comprehensive WP 6.5+ Interactivity API coverage including complete directive catalog, state management, context vs state, server-side setup, and integration with dynamic blocks. Both follow cookbook format with appropriate coding standards and BAD/GOOD pairs.
  </done>
</task>

</tasks>

<verification>
- All 4 reference docs exist in `skills/wp-block-development/references/`
- Each has quick reference table at top (cookbook format)
- Total line count across all 4 files is 1500+ lines
- BAD/GOOD code pairs used throughout
- PHP examples follow WordPress PHP Coding Standards
- JS/JSX examples follow WordPress JS coding standards
- Cross-references between reference docs present
- Security-relevant patterns reference wp-security-review skill
- Plugin architecture patterns reference wp-plugin-development skill
- block-json-guide.md covers BLK-26 requirements (complete schema reference)
- editor-patterns.md covers BLK-27 requirements (React/JSX patterns)
- dynamic-blocks-guide.md covers server-side rendering patterns
- interactivity-api-guide.md covers BLK-28 requirements (WP 6.5+ Interactivity API)
</verification>

<success_criteria>
- All 4 reference docs provide deep-dive companion content to SKILL.md
- Any topic mentioned in SKILL.md that says "see references" has corresponding depth in a reference doc
- PHP code examples are copy-pasteable and follow WordPress PHP Coding Standards
- JS/JSX code examples are copy-pasteable and follow WordPress JS coding standards
- A Claude instance could load any reference doc to get comprehensive guidance on that topic
- Interactivity API guide includes WP 6.5+ version markers throughout
</success_criteria>

<output>
After completion, create `.planning/phases/03-gutenberg-blocks/03-02-SUMMARY.md`
</output>
