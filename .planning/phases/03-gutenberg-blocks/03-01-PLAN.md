---
phase: 03-gutenberg-blocks
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/wp-block-development/SKILL.md
autonomous: true

must_haves:
  truths:
    - "Claude can detect block.json schema issues, missing useBlockProps, InnerBlocks misuse, save function validation errors, missing deprecation handlers, and Interactivity API misuse in WordPress block code"
    - "Claude reports findings grouped by file (PHP and JS/JSX intermixed by path) with severity (CRITICAL/WARNING/INFO), line numbers, and BAD/GOOD code pairs"
    - "Claude distinguishes block context (single block plugin, multi-block plugin, block library, theme blocks) to adjust review"
    - "Claude can run grep-based quick detection from the Search Patterns section across both PHP and JS/JSX files"
    - "Claude automatically activates this skill from trigger phrases like 'block review', 'Gutenberg', 'block.json', 'useBlockProps', 'InnerBlocks', 'Interactivity API', 'render_callback'"
    - "Security-relevant findings cross-reference wp-security-review; plugin architecture issues cross-reference wp-plugin-development"
  artifacts:
    - path: "skills/wp-block-development/SKILL.md"
      provides: "Complete block development review skill with 12 sections matching security/plugin skill structure"
      min_lines: 600
      contains: "name: wp-block-development"
  key_links:
    - from: "skills/wp-block-development/SKILL.md"
      to: "references/*.md"
      via: "Deep-Dive References table"
      pattern: "references/block-json-guide\\.md|references/editor-patterns\\.md|references/dynamic-blocks-guide\\.md|references/interactivity-api-guide\\.md"
    - from: "skills/wp-block-development/SKILL.md"
      to: "skills/wp-security-review/SKILL.md"
      via: "Cross-reference for security concerns"
      pattern: "wp-security-review|/wp-sec-review"
    - from: "skills/wp-block-development/SKILL.md"
      to: "skills/wp-plugin-development/SKILL.md"
      via: "Cross-reference for plugin architecture concerns"
      pattern: "wp-plugin-development|/wp-plugin-review"
---

<objective>
Create the main SKILL.md for wp-block-development -- the core skill file that teaches Claude how to review WordPress block editor (Gutenberg) code for WordPress 6.5+.

Purpose: This is the primary deliverable of Phase 3. It defines the complete block review workflow covering both PHP (server-side rendering, block registration) and JavaScript/React (editor components, save functions). This is the first skill that covers JavaScript/React code alongside PHP. It covers block.json validation, static vs dynamic blocks, useBlockProps, InnerBlocks, block deprecations, block controls, attributes, block supports, and Interactivity API directives. Cross-references wp-security-review for security and wp-plugin-development for plugin architecture.

Output: `skills/wp-block-development/SKILL.md` (~800+ lines) with 12 sections mirroring the existing skill structure.
</objective>

<execution_context>
@/Users/seth/.claude/get-shit-done/workflows/execute-plan.md
@/Users/seth/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-gutenberg-blocks/03-CONTEXT.md
@.planning/phases/03-gutenberg-blocks/03-RESEARCH.md
@skills/wp-performance-review/SKILL.md
@skills/wp-security-review/SKILL.md
@skills/wp-plugin-development/SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SKILL.md with YAML frontmatter and 12-section structure</name>
  <files>skills/wp-block-development/SKILL.md</files>
  <action>
Create `skills/wp-block-development/SKILL.md` following the EXACT section structure of the existing `skills/wp-plugin-development/SKILL.md` (use it as the primary structural template -- it's the most comprehensive at 1,264 lines) but with block development content. Also reference `skills/wp-security-review/SKILL.md` and `skills/wp-performance-review/SKILL.md` for consistent formatting.

**IMPORTANT: This is the first skill covering BOTH PHP and JavaScript/React code.** All sections must address both languages where applicable. PHP examples follow WordPress PHP Coding Standards (spaces in parentheses, array() not [], Yoda conditions). JavaScript/JSX examples follow WordPress JS coding standards (tab indentation, JSDoc comments, camelCase, PascalCase for components).

**YAML Frontmatter (BLK-01):**
- `name: wp-block-development`
- `description:` Must include trigger phrases and fit within 1024 characters. Include: "WordPress block editor code review and Gutenberg block development patterns", "block review", "Gutenberg", "block.json", "block development", "block editor", "useBlockProps", "InnerBlocks", "Interactivity API", "data-wp-bind", "render_callback", "dynamic block", "static block", "block deprecation", "block attributes", "block supports", "@wordpress/scripts", "wp-scripts", "block validation error", "save function". Describe what the skill reviews (block.json schema, editor components, render callbacks, block deprecations, Interactivity API directives).

**12 Sections (mirror plugin/security skill layout):**

1. **Overview** -- Systematic block development review for WordPress 6.5+. Core principle: WordPress blocks follow a dual-architecture pattern -- React components for the editor (edit function) and either static HTML (save function) or server-side PHP (render_callback/render file) for the frontend. block.json is the single source of truth. Review validates block.json schema, editor patterns (React/JSX), server-side rendering (PHP), attribute handling, deprecation management, and Interactivity API usage. Report with line numbers, severity, BAD/GOOD code pairs. Note: This skill reviews BOTH PHP and JS/JSX files.

2. **When to Use / Don't Use** -- Use for: block plugin code review, block.json validation, editor component review (edit/save functions), render callback audit, InnerBlocks pattern review, block deprecation check, Interactivity API directive review, block attribute schema validation, @wordpress/scripts build configuration check. Don't use for: theme.json configuration (use wp-theme-development when available), general React application review (this is block-editor-specific), WooCommerce block extensions (use wp-woocommerce-development when available), security-only audits (use wp-security-review), plugin architecture audits (use wp-plugin-development), performance-only audits (use wp-performance-review).

3. **Code Review Workflow** -- 7-step workflow:
   1. Identify block type and context (single block plugin / multi-block plugin / block library / theme blocks)
   2. Validate block.json schema (apiVersion, name, title, category, attributes, supports, editorScript, style, render)
   3. Check edit function (useBlockProps present, proper attribute usage, InspectorControls/BlockControls usage, import patterns using @wordpress/* not window.wp.*)
   4. Check save function or render callback:
      - Static blocks: useBlockProps.save() present, attributes rendered correctly, InnerBlocks.Content used if nested
      - Dynamic blocks: save returns null (or InnerBlocks.Content if nested), render_callback/render file escapes output, uses get_block_wrapper_attributes()
   5. Scan for CRITICAL patterns (missing apiVersion or using 1/2, save function mismatch without deprecation, missing useBlockProps in save, invalid attribute type/source, InnerBlocks without InnerBlocks.Content in save, wp_kses_post on InnerBlocks content)
   6. Check WARNING patterns (missing block supports, deprecated API usage like source:'meta', hardcoded strings without i18n, no deprecation handler for save changes, missing viewScript for frontend interactions)
   7. Note INFO improvements (could use render PHP file instead of render_callback, missing block.json $schema, not using viewScriptModule for Interactivity API, block hooks for auto-insertion)
   Report using output format below. If security concerns found, suggest /wp-sec-review. If plugin architecture issues found, suggest /wp-plugin-review.

   **Source vs Build Review:** Review src/ files for code patterns (developer intent). Flag if build/ directory is missing or stale. Do NOT review build/ files for code quality -- they are compiled output.

4. **File-Type Specific Checks** -- Organized by file type (PHP AND JS/JSX):

   **block.json (BLK-02, BLK-06, BLK-08, BLK-10):**
   - apiVersion must be 3 (WP 6.3+). Flag 1 or 2 as WARNING with upgrade guidance.
   - name must be "namespace/block-name" format (lowercase, letters, numbers, dashes)
   - title, category required
   - attributes: validate type (string/number/boolean/object/array/integer/null), source (attribute/text/html/query/meta[deprecated]), selector, default values. Flag type mismatches with source.
   - supports: color, spacing, typography, align, anchor, html. Flag missing common supports.
   - editorScript, script, viewScript, viewScriptModule: validate "file:./path" format. viewScriptModule for Interactivity API (WP 6.5+).
   - style, editorStyle: validate paths
   - render: "file:./render.php" for dynamic blocks
   - $schema field recommended for validation

   **Edit function / edit.js (BLK-05, BLK-20):**
   - useBlockProps() MUST be called and spread on wrapper element
   - Import pattern: @wordpress/* packages (GOOD) vs window.wp.* (BAD -- legacy)
   - InspectorControls for sidebar settings, BlockControls for toolbar
   - RichText proper usage (tagName, value, onChange, allowedFormats)
   - InnerBlocks with allowedBlocks and template props
   - useSelect/useDispatch from @wordpress/data (combine selectors in single useSelect call)
   - i18n: all user-facing strings wrapped in __() from @wordpress/i18n with text domain

   **Save function / save.js (BLK-05, BLK-07):**
   - Static blocks: useBlockProps.save() MUST be called, RichText.Content for rich text, InnerBlocks.Content for nested blocks
   - Dynamic blocks: save returns null (or InnerBlocks.Content if nested blocks used -- BLK-14 CRITICAL gotcha)
   - Save function must be DETERMINISTIC -- no random values, no Date.now(), no side effects

   **Render callback / render.php (BLK-11):**
   - get_block_wrapper_attributes() for wrapper element (NOT manual class concatenation)
   - $attributes parameter for block attributes, $content for InnerBlocks content, $block for WP_Block instance
   - Escape all output: esc_html(), esc_attr(), esc_url(), wp_kses_post() (but NOT on $content from InnerBlocks -- BLK-21)
   - defined( 'ABSPATH' ) || exit; at top

   **Plugin main file / plugin.php:**
   - register_block_type() on 'init' hook pointing to build directory
   - For multi-block: register_block_type() for each block's build/block-name/ directory
   - Cross-reference wp-plugin-development for plugin header, ABSPATH check, prefixing patterns

   **Block deprecation (BLK-09):**
   - deprecated array with save + attributes for each version change
   - migrate function for attribute schema changes
   - apiVersion must be specified in deprecation entries
   - Newest deprecation listed FIRST in array

   **Interactivity API files (BLK-12):**
   - render.php: data-wp-interactive="namespace", wp_interactivity_state(), wp_interactivity_config(), data-wp-context
   - view.js: import { store } from '@wordpress/interactivity', store() with actions/state
   - WP 6.5+ version marker: flag if targeting earlier WordPress versions
   - Key distinction: Interactivity API = FRONTEND only. Editor still uses React.
   - Directives: data-wp-bind, data-wp-on, data-wp-class, data-wp-style, data-wp-text, data-wp-context, data-wp-watch, data-wp-init, data-wp-each

   **Block context (BLK-16):**
   - providesContext in parent block.json, usesContext in child block.json
   - context prop in child edit function
   - Namespace context keys: "myPlugin/keyName"

   **Surface-level checks:**
   - Block transforms (BLK-13 partial): from/to array in block registration
   - Block variations (BLK-13): variation picker, isDefault, scope
   - Block styles: style variations in block.json or PHP registration
   - Block patterns (BLK-18): register_block_pattern() structure, categories, keywords
   - Block hooks (BLK-19): blockHooks property, dynamic blocks only (WP 6.4+)
   - Block Bindings API (BLK-17): dynamic attribute connections
   - @wordpress/scripts build config: package.json scripts, wp-scripts build/start
   - Template lock: templateLock prop on InnerBlocks

   Each check item includes: pattern to find, severity level, brief explanation.

5. **Search Patterns for Quick Detection (BLK-22)** -- Bash grep commands organized by severity, covering BOTH PHP and JS/JSX files:

   CRITICAL:
   - block.json without apiVersion or apiVersion < 3
   - JS/JSX files with window.wp.* instead of @wordpress/* imports
   - save function without useBlockProps.save() (search *.js *.jsx)
   - render callback using wp_kses_post on $content parameter (search *.php)
   - Dynamic block with InnerBlocks but save returns null (no InnerBlocks.Content)
   - Attribute with source: 'meta' (deprecated)
   - Missing register_block_type() call in PHP files

   WARNING:
   - block.json missing supports field
   - edit function without useBlockProps() (search *.js *.jsx)
   - Hardcoded strings not wrapped in __() in JS/JSX files
   - render.php without get_block_wrapper_attributes()
   - PHP render files without defined( 'ABSPATH' ) check
   - save function with side effects (Math.random, Date.now)
   - Missing block.json $schema field
   - useSelect with multiple separate calls (performance anti-pattern)

   INFO:
   - Using render_callback in PHP instead of render file in block.json
   - Missing viewScript/viewScriptModule in block.json (no frontend JS)
   - apiVersion 2 (suggest upgrade to 3)
   - Missing keywords in block.json
   - Not using block hooks for auto-insertion opportunities

   Use comments to explain each grep. Note that JS grep patterns need different regex than PHP patterns. These patterns are used by /wp-block quick scan.

6. **Block Context Detection** -- Context-aware review notes:
   - **Single block plugin**: One block, simple structure. block.json at root or src/. Standard review.
   - **Multi-block plugin**: Multiple blocks in src/block-one/, src/block-two/. Check shared components, consistent naming, build config handles all blocks.
   - **Block library/collection**: Published as package. Namespacing critical. Check for consistent namespace across all blocks.
   - **Theme blocks**: Registered in functions.php, different loading context. Block may depend on theme.json settings. Brief note, defer theme depth to Phase 4.

7. **Quick Reference: Block Development Patterns (BLK-23)** -- Organized by concern with BAD/GOOD code pairs. Cover all deep-coverage areas:
   - block.json Schema -- complete schema with all fields annotated, apiVersion 3
   - Block Registration -- register_block_type() with __DIR__ . '/build/block-name', PHP + JS registration pattern
   - Static Block Pattern -- edit with useBlockProps, save with useBlockProps.save, RichText + RichText.Content
   - Dynamic Block Pattern -- edit with useBlockProps, save returns null (or InnerBlocks.Content), render.php with get_block_wrapper_attributes and escaping
   - InnerBlocks Pattern -- allowedBlocks, template, templateLock, InnerBlocks.Content in save (even for dynamic blocks)
   - useBlockProps -- edit (useBlockProps()) and save (useBlockProps.save()), merging custom props
   - Attributes -- type/source/selector/default patterns, attribute type matching
   - Block Controls -- InspectorControls for sidebar, BlockControls for toolbar, PanelBody, ToggleControl, SelectControl
   - Block Deprecation -- deprecated array, save + attributes + migrate, apiVersion in entries, newest first
   - Interactivity API -- data-wp-interactive, data-wp-bind, data-wp-on, store(), wp_interactivity_state(), frontend-only emphasis
   - Import Patterns -- @wordpress/* package imports vs window.wp.* legacy access
   - Block Supports -- color, spacing, typography, align, anchor in block.json

   Plus surface-level patterns:
   - Block Variations -- variation objects with attributes and innerBlocks
   - Block Transforms -- from/to patterns
   - Block Context -- providesContext/usesContext
   - Block Hooks -- blockHooks with dynamic blocks only
   - @wordpress/scripts -- package.json scripts configuration

   ALL PHP code examples follow WordPress PHP Coding Standards.
   ALL JS/JSX code examples follow WordPress JS coding standards (tab indentation, camelCase, PascalCase).
   ALL code pairs use BAD/GOOD pattern.

8. **Severity Definitions (BLK-24)** -- Table matching security/performance/plugin skill format:
   - CRITICAL: Block won't render OR crashes editor -- missing apiVersion, invalid attribute type causing save validation error, save function mismatch without deprecation, missing useBlockProps in save (apiVersion 3), InnerBlocks without InnerBlocks.Content in save, wp_kses_post on InnerBlocks $content, window.wp.* access breaking build
   - WARNING: Block works but has quality/compatibility issues -- deprecated API usage (source:'meta'), missing block supports, no deprecation handler for changed save, hardcoded strings without i18n, multiple useSelect calls (performance), missing get_block_wrapper_attributes in render
   - INFO: Best practice improvements -- could use render PHP file instead of render_callback, missing viewScript for frontend interactions, not using block.json $schema, apiVersion 2 (upgrade available), missing keywords, block hooks opportunity

9. **Output Format (BLK-24)** -- Match security/performance/plugin skill format exactly:
   - Group findings by FILE (PHP and JS/JSX files intermixed by actual file path)
   - Each finding: line number, severity, issue description, explanation, BAD/GOOD code pair with fix
   - Summary at end with total counts by severity
   - If security concerns found: "Security issues detected. Run `/wp-sec-review` for comprehensive security analysis."
   - If plugin architecture issues found: "Plugin architecture issues detected. Run `/wp-plugin-review` for comprehensive plugin review."

10. **Common Mistakes (BLK-25)** -- Table of patterns that look like issues but are NOT:
    - Dynamic block save() returning null is correct (server renders output)
    - InnerBlocks.Content without useBlockProps wrapper is valid for dynamic blocks that only need to persist nested blocks
    - viewScript not needed if block has no frontend JavaScript behavior
    - render_callback without return is valid if it echoes output (though return is preferred)
    - Missing style/editorStyle in block.json is fine if block uses theme defaults or no custom styling
    - apiVersion 2 blocks still work (just missing iframe isolation features)
    - Block without supports is valid for simple blocks that don't need color/spacing/typography
    - save() function with className in wrapper -- apiVersion 2 auto-injects, apiVersion 3 does not (use useBlockProps.save())
    - window.wp.* in browser console is expected -- only @wordpress/* imports in source code matter
    - Interactivity API not needed for blocks with no frontend interaction
    Add more from RESEARCH.md common pitfalls.

11. **Version Compatibility Reference** -- Quick reference for WP version requirements:
    - WP 5.8+: block.json metadata support
    - WP 6.2+: InspectorControls group prop (Settings/Appearance tabs)
    - WP 6.3+: apiVersion 3, iframe editor isolation
    - WP 6.4+: Block Hooks API
    - WP 6.5+: Interactivity API, viewScriptModule, Block Bindings API

12. **Deep-Dive References** -- Table linking to companion reference docs:
    | Task | Reference to Load |
    |------|-------------------|
    | block.json schema validation and field reference | `references/block-json-guide.md` |
    | React/JSX editor component patterns | `references/editor-patterns.md` |
    | Server-side rendering and render callbacks | `references/dynamic-blocks-guide.md` |
    | Interactivity API directives and state | `references/interactivity-api-guide.md` |

**Content sourcing:** Use 03-RESEARCH.md extensively -- it has verified code examples, architecture patterns, and pitfalls. Adapt and organize into SKILL.md sections. The SKILL.md should be concise and actionable, with reference docs handling deep dives.

**Critical constraint:** The SKILL.md must be SELF-SUFFICIENT for a standard block review. Reference docs add depth but are not required for basic reviews.

**Security crossover (LOCKED DECISION):** Do NOT duplicate security patterns. When encountering security-relevant patterns (unescaped render output, user input in Interactivity API state), include a brief reminder and add: "See wp-security-review skill for detailed security analysis" or suggest /wp-sec-review.

**Plugin crossover (LOCKED DECISION):** Do NOT duplicate plugin architecture patterns. When encountering plugin-level patterns (init hook registration, ABSPATH check), include brief mention and add: "See wp-plugin-development skill for plugin architecture depth" or suggest /wp-plugin-review.
  </action>
  <verify>
- File exists at `skills/wp-block-development/SKILL.md`
- YAML frontmatter has `name: wp-block-development` and `description` under 1024 chars with trigger phrases
- All 12 sections present (check for ## headings matching the template)
- PHP code examples use WordPress PHP Coding Standards (spaces in parentheses, array() not [])
- JS/JSX code examples use WordPress JS coding standards (tab indentation, camelCase, PascalCase)
- BAD/GOOD pattern used consistently in both PHP and JS/JSX examples
- Severity levels (CRITICAL/WARNING/INFO) used correctly per block definitions
- Search Patterns section has runnable bash grep commands for BOTH PHP and JS/JSX files
- Deep-Dive References table lists all 4 reference docs
- Security cross-references present (mentions wp-security-review, /wp-sec-review)
- Plugin cross-references present (mentions wp-plugin-development, /wp-plugin-review)
- Context-aware detection for single block / multi-block / block library / theme blocks
- Interactivity API patterns include WP 6.5+ version markers
- File is at least 600 lines
  </verify>
  <done>
SKILL.md exists with all 12 sections, correct frontmatter, detection patterns for block.json schema, editor components (React/JSX), save functions, render callbacks, InnerBlocks, block deprecations, block controls, attributes, supports, Interactivity API directives, and version compatibility. Grep patterns cover both PHP and JS/JSX files. Output format grouped by file. Common false-positive table. Security and plugin cross-references. Reference doc links. All code examples follow appropriate coding standards (WP PHP for PHP, WP JS for JS/JSX) with BAD/GOOD pairs.
  </done>
</task>

</tasks>

<verification>
- `skills/wp-block-development/SKILL.md` exists with valid YAML frontmatter
- `name` field is `wp-block-development`
- `description` field is under 1024 characters and includes trigger phrases
- File has 12 major sections matching security/plugin/performance skill structure
- All deep-coverage areas have detection patterns and code examples (block.json, editor components, save functions, render callbacks, InnerBlocks, deprecations, Interactivity API)
- All surface-level areas have scan patterns + brief guidance (transforms, variations, styles, patterns, hooks, Bindings API, build config)
- Context-aware detection present (single block, multi-block, block library, theme blocks)
- Common Mistakes table has at least 10 false-positive scenarios
- Search Patterns section has categorized grep commands for PHP AND JS/JSX
- Security cross-references present throughout
- Plugin architecture cross-references present throughout
- Output format matches security/plugin/performance skills (grouped by file, BAD/GOOD pairs)
- Requirements BLK-01 through BLK-25 are covered
</verification>

<success_criteria>
- SKILL.md is a complete, self-sufficient block development review guide that Claude can follow
- All BLK requirements mapped to this plan (BLK-01 through BLK-25) are covered
- Structure mirrors wp-plugin-development/SKILL.md exactly (12 sections, same ordering)
- A Claude instance could perform a meaningful WordPress block review using ONLY this SKILL.md
- Both PHP and JavaScript/React patterns are covered throughout
- Security concerns cross-reference wp-security-review instead of duplicating
- Plugin architecture concerns cross-reference wp-plugin-development instead of duplicating
</success_criteria>

<output>
After completion, create `.planning/phases/03-gutenberg-blocks/03-01-SUMMARY.md`
</output>
